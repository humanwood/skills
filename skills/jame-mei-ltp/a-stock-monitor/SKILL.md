---
name: a-stock-monitor
description: Aè‚¡å®æ—¶ç›‘æ§ç³»ç»Ÿ - 7ç»´åº¦å¸‚åœºæƒ…ç»ªè¯„åˆ†ã€å®æ—¶ä»·æ ¼ç›‘æ§ã€æ¶¨è·Œå¹…æ’è¡Œæ¦œã€‚æ”¯æŒå…¨å¸‚åœº5000+è‚¡ç¥¨æ•°æ®é‡‡é›†ä¸åˆ†æï¼Œæ™ºèƒ½åˆ¤æ–­äº¤æ˜“æ—¶é—´ï¼Œäº¤æ˜“æ—¶æ®µæ¯5ç§’æ›´æ–°ä»·æ ¼ã€‚åŒ…å«Webç•Œé¢ã€è‡ªåŠ¨åŒ–Cronä»»åŠ¡ã€å†å²æ•°æ®å›æº¯ã€‚é€‚ç”¨äºAè‚¡é‡åŒ–åˆ†æã€å¸‚åœºæƒ…ç»ªè¿½è¸ªã€ä¸ªè‚¡ç›‘æ§å‘Šè­¦ã€‚
metadata:
  openclaw:
    requires:
      bins: ["python3"]
      packages: ["akshare", "flask", "ccxt"]
---

# Aè‚¡å®æ—¶ç›‘æ§ç³»ç»Ÿ

ä¸€ä¸ªå®Œæ•´çš„Aè‚¡å®æ—¶ç›‘æ§ä¸å¸‚åœºæƒ…ç»ªåˆ†æç³»ç»Ÿã€‚

## æ ¸å¿ƒåŠŸèƒ½

### 1. å¸‚åœºæƒ…ç»ªè¯„åˆ† (7ç»´åº¦)
åŸºäºå…¨å¸‚åœº5000+åªAè‚¡çš„ç»¼åˆæƒ…ç»ªè¯„åˆ†ï¼ˆ0-100åˆ†ï¼‰ï¼š
- æ¶¨è·Œå®¶æ•°æ¯” (20%)
- å¹³å‡æ¶¨å¹… (20%)
- æ¶¨åœ/è·Œåœæ¯” (15%)
- å¼ºåŠ¿è‚¡å æ¯” (15%)
- æˆäº¤æ´»è·ƒåº¦ (10%)
- æ³¢åŠ¨ç‡ (10%)
- è¶‹åŠ¿å¼ºåº¦ (10%)

### 2. å®æ—¶ä»·æ ¼ç›‘æ§
- äº¤æ˜“æ—¶é—´ï¼šæ¯5ç§’æ›´æ–°ä»·æ ¼
- éäº¤æ˜“æ—¶é—´ï¼šæ˜¾ç¤ºå†å²æ•°æ®
- è‡ªåŠ¨åˆ¤æ–­äº¤æ˜“æ—¶æ®µï¼ˆ9:15-11:30, 13:00-15:00ï¼‰

### 3. æ¶¨è·Œå¹…æ’è¡Œæ¦œ
- å®æ—¶æ¶¨å¹…æ¦œï¼ˆTop 5ï¼‰
- å®æ—¶è·Œå¹…æ¦œï¼ˆTop 5ï¼‰
- æ”¯æŒç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…

### 4. Webå¯è§†åŒ–ç•Œé¢
- å¸‚åœºæƒ…ç»ªä»ªè¡¨ç›˜
- ç›‘æ§è‚¡ç¥¨å¡ç‰‡å±•ç¤º
- ç»Ÿè®¡æ•°æ®æ±‡æ€»
- å“åº”å¼è®¾è®¡

## ä½¿ç”¨æ–¹å¼

### å¿«é€Ÿå¼€å§‹

1. **å®‰è£…ä¾èµ–**
```bash
pip3 install akshare flask ccxt
```

2. **é…ç½®ç›‘æ§è‚¡ç¥¨**
ç¼–è¾‘ `web_app.py`ï¼Œä¿®æ”¹ `WATCHED_STOCKS` åˆ—è¡¨ï¼š
```python
WATCHED_STOCKS = [
    '600900',  # é•¿æ±Ÿç”µåŠ›
    '601985',  # ä¸­å›½æ ¸ç”µ
    # æ·»åŠ æ›´å¤šè‚¡ç¥¨ä»£ç ...
]
```

3. **å¯åŠ¨WebæœåŠ¡**
```bash
cd scripts/
python3 web_app.py
```
è®¿é—® `http://localhost:5000`

### è‡ªåŠ¨åŒ–è¿è¡Œ

**è®¾ç½®Cronä»»åŠ¡**ï¼ˆäº¤æ˜“æ—¶é—´æ¯5åˆ†é’Ÿæ›´æ–°ï¼‰ï¼š
```bash
openclaw cron add --name "Aè‚¡å…¨å¸‚åœºæ•°æ®æ›´æ–°" \
  --schedule "*/5 9-15 * * 1-5" \
  --tz "Asia/Shanghai" \
  --payload '{"kind":"systemEvent","text":"cd <skill-path>/scripts && python3 smart_market_updater.py"}'
```

æ›¿æ¢ `<skill-path>` ä¸ºæŠ€èƒ½å®‰è£…è·¯å¾„ã€‚

### æ‰‹åŠ¨æ‰§è¡Œ

```bash
# æ›´æ–°å…¨å¸‚åœºæ•°æ®
python3 scripts/update_all_market_data.py

# è®¡ç®—å¸‚åœºæƒ…ç»ª
python3 scripts/market_sentiment.py

# æ™ºèƒ½æ›´æ–°ï¼ˆä»…äº¤æ˜“æ—¶é—´ï¼‰
python3 scripts/smart_market_updater.py

# æ£€æŸ¥äº¤æ˜“æ—¶é—´
python3 scripts/is_trading_time.py
```

## ç›®å½•ç»“æ„

```
scripts/
â”œâ”€â”€ web_app.py                      # Flask WebæœåŠ¡
â”œâ”€â”€ stock_cache_db.py               # SQLiteæ•°æ®ç¼“å­˜
â”œâ”€â”€ stock_async_fetcher.py          # å¼‚æ­¥æ•°æ®è·å–
â”œâ”€â”€ market_sentiment.py             # å¸‚åœºæƒ…ç»ªè®¡ç®—
â”œâ”€â”€ is_trading_time.py              # äº¤æ˜“æ—¶é—´åˆ¤æ–­
â”œâ”€â”€ smart_market_updater.py         # æ™ºèƒ½æ›´æ–°å™¨
â”œâ”€â”€ update_all_market_data.py       # å…¨å¸‚åœºæ•°æ®æ›´æ–°
â””â”€â”€ templates/
    â””â”€â”€ index.html                  # Webå‰ç«¯é¡µé¢
```

## APIç«¯ç‚¹

### GET /api/market/sentiment
è¿”å›å…¨å¸‚åœºæƒ…ç»ªè¯„åˆ†

**å“åº”ç¤ºä¾‹**:
```json
{
  "score": 57,
  "level": "åä¹è§‚",
  "emoji": "ğŸŸ¢",
  "description": "å¸‚åœºåå¼ºï¼Œæƒ…ç»ªç¨³å®š",
  "stats": {
    "total": 5000,
    "gainers": 2460,
    "losers": 2534,
    "limit_up": 15,
    "limit_down": 3
  }
}
```

### GET /api/stocks
è¿”å›æ‰€æœ‰ç›‘æ§è‚¡ç¥¨æ•°æ®

### GET /api/stocks/realtime
è¿”å›ç›‘æ§è‚¡ç¥¨å®æ—¶ä»·æ ¼ï¼ˆè½»é‡çº§ï¼‰

### GET /api/stock/<code>
è¿”å›å•åªè‚¡ç¥¨è¯¦æƒ…

## é…ç½®è¯´æ˜

### äº¤æ˜“æ—¶é—´é…ç½®
é»˜è®¤äº¤æ˜“æ—¶é—´ï¼šå‘¨ä¸€è‡³å‘¨äº” 9:15-15:00

ä¿®æ”¹ `is_trading_time.py`ï¼š
```python
TRADING_HOURS = {
    'morning': (9, 15, 11, 30),    # 9:15-11:30
    'afternoon': (13, 0, 15, 0),   # 13:00-15:00
}
```

### æ•°æ®ç¼“å­˜é…ç½®
SQLiteæ•°æ®åº“ï¼š`stock_cache.db`
é»˜è®¤ç¼“å­˜æ—¶é—´ï¼š30åˆ†é’Ÿ

ä¿®æ”¹ `stock_cache_db.py`ï¼š
```python
MAX_AGE_MINUTES = 30  # ç¼“å­˜æœ‰æ•ˆæœŸ
```

### ç›‘æ§è‚¡ç¥¨é…ç½®
ç¼–è¾‘ `web_app.py` ä¸­çš„ `WATCHED_STOCKS` åˆ—è¡¨

### å¸‚åœºæƒ…ç»ªé˜ˆå€¼
ä¿®æ”¹ `market_sentiment.py`ï¼š
```python
# æƒ…ç»ªç­‰çº§é˜ˆå€¼
LEVELS = [
    (80, 100, 'æåº¦ä¹è§‚', 'ğŸ”´'),
    (65, 79, 'ä¹è§‚', 'ğŸŸ '),
    (55, 64, 'åä¹è§‚', 'ğŸŸ¢'),
    # ...
]
```

## æ•°æ®æ¥æº

- **akshare**: è·å–Aè‚¡å®æ—¶è¡Œæƒ…ã€å…¨å¸‚åœºæ•°æ®
- **æœ¬åœ°ç¼“å­˜**: SQLiteæ•°æ®åº“å­˜å‚¨å†å²æ•°æ®

## æ€§èƒ½ä¼˜åŒ–

1. **åˆ†çº§æ›´æ–°**
   - å®æ—¶ä»·æ ¼: 5ç§’ï¼ˆä»…ä»·æ ¼+æ¶¨è·Œï¼‰
   - å®Œæ•´æ•°æ®: 30ç§’ï¼ˆå«æŠ€æœ¯æŒ‡æ ‡ï¼‰
   - åç«¯æ›´æ–°: 5åˆ†é’Ÿï¼ˆå…¨å¸‚åœºæ•°æ®ï¼‰

2. **æ™ºèƒ½ç¼“å­˜**
   - äº¤æ˜“æ—¶é—´: 5åˆ†é’Ÿç¼“å­˜
   - éäº¤æ˜“æ—¶é—´: æ˜¾ç¤ºå†å²æ•°æ®

3. **å¼‚æ­¥è·å–**
   - ä½¿ç”¨å¼‚æ­¥æ–¹å¼è·å–å…¨å¸‚åœºæ•°æ®
   - é¿å…é˜»å¡ä¸»çº¿ç¨‹

## æ•…éšœæ’æŸ¥

### é—®é¢˜1: æ•°æ®å…¨ä¸ºnull
**åŸå› **: éäº¤æ˜“æ—¶é—´ï¼Œakshareè¿”å›ç©ºæ•°æ®
**è§£å†³**: ç­‰å¾…äº¤æ˜“æ—¶é—´ï¼Œæˆ–å¯¼å…¥æ¼”ç¤ºæ•°æ®

### é—®é¢˜2: Webç•Œé¢ä¸€ç›´è½¬åœˆ
**åŸå› **: æ•°æ®åº“æ— æœ‰æ•ˆæ•°æ®
**è§£å†³**: è¿è¡Œ `python3 update_all_market_data.py`

### é—®é¢˜3: Cronä»»åŠ¡ä¸æ‰§è¡Œ
**åŸå› **: æ—¶åŒºé…ç½®é”™è¯¯
**è§£å†³**: ç¡®ä¿æ—¶åŒºè®¾ç½®ä¸º `Asia/Shanghai`

### é—®é¢˜4: ç«¯å£è¢«å ç”¨
**åŸå› **: Flaské»˜è®¤ç«¯å£5000å†²çª
**è§£å†³**: ä¿®æ”¹ `web_app.py` ä¸­çš„ç«¯å£å·

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„ç›‘æ§æŒ‡æ ‡
ç¼–è¾‘ `market_sentiment.py`ï¼Œæ·»åŠ æ–°çš„è¯„åˆ†ç»´åº¦ï¼š

```python
def calculate_sentiment(stocks):
    # æ·»åŠ æ–°ç»´åº¦
    new_dimension_score = calculate_new_dimension(stocks)
    
    # è°ƒæ•´æƒé‡
    score = (
        gain_ratio_score * 0.18 +      # é™ä½åŸæœ‰æƒé‡
        # ...
        new_dimension_score * 0.10      # æ–°ç»´åº¦10%
    )
```

### è‡ªå®šä¹‰å‘Šè­¦è§„åˆ™
åˆ›å»ºæ–°çš„å‘Šè­¦è„šæœ¬ï¼š

```python
def check_custom_alert():
    cache = StockCache()
    stocks = cache.get_all_stocks()
    
    # è‡ªå®šä¹‰å‘Šè­¦é€»è¾‘
    alerts = []
    for stock in stocks:
        if stock['change_pct'] > 5:
            alerts.append(stock)
    
    if alerts:
        send_alert(alerts)
```

## æŠ€æœ¯æ ˆ

- **åç«¯**: Python 3.9+, Flask
- **æ•°æ®**: akshare, SQLite
- **å‰ç«¯**: jQuery, Bootstrap
- **è‡ªåŠ¨åŒ–**: OpenClaw Cron

## è®¸å¯è¯

MIT License

## è‡´è°¢

- akshare æä¾›Aè‚¡æ•°æ®æ¥å£
- OpenClaw æä¾›è‡ªåŠ¨åŒ–è°ƒåº¦èƒ½åŠ›
